<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Media Tracker</title>
<style>
/* ‚Äî‚Äî‚Äî RESET & BASE ‚Äî‚Äî‚Äî */
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,sans-serif;
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  min-height:100vh;display:flex;justify-content:center;align-items:center;padding:20px}
.container{
  background:#fff;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,.3);
  max-width:600px;width:100%;padding:40px}
h1{color:#333;margin-bottom:10px;font-size:28px}
.subtitle{color:#666;margin-bottom:30px;font-size:14px}
.form-group{margin-bottom:25px}
label{display:block;margin-bottom:8px;color:#555;font-weight:500;font-size:14px}
input[type="text"],input[type="url"],select{
  width:100%;padding:12px;border:2px solid #e0e0e0;border-radius:8px;font-size:14px;transition:border-color .3s}
input[type="text"]:focus,input[type="url"]:focus,select:focus{outline:none;border-color:#667eea}
.file-upload{position:relative;display:inline-block;width:100%}
.file-upload input[type="file"]{position:absolute;opacity:0;width:100%;height:100%;cursor:pointer}
.file-upload-label{
  display:block;padding:12px;background:#f8f9fa;border:2px dashed #dee2e6;border-radius:8px;
  text-align:center;cursor:pointer;transition:all .3s}
.file-upload-label:hover{background:#e9ecef;border-color:#667eea}
.file-upload-label.has-file{background:#e8f5e9;border-color:#4caf50;color:#2e7d32}
.file-upload-label.twitter{border-color:#1da1f2}
.file-upload-label.twitter:hover{background:#e3f2fd;border-color:#1976d2}
.file-upload-label.twitter.has-file{background:#e3f2fd;border-color:#1976d2;color:#1565c0}
.csv-uploads{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:25px}
@media(max-width:600px){.csv-uploads{grid-template-columns:1fr}}
.checkbox-group{display:flex;gap:20px;flex-wrap:wrap}
.checkbox-item{display:flex;align-items:center}
.checkbox-item input[type="checkbox"]{margin-right:6px}
.submit-btn{
  width:100%;padding:14px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  color:#fff;border:none;border-radius:8px;font-size:16px;font-weight:600;cursor:pointer;
  transition:transform .2s,box-shadow .2s}
.submit-btn:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 10px 20px rgba(102,126,234,.4)}
.submit-btn:disabled{opacity:.6;cursor:not-allowed}
.status-message{margin-top:20px;padding:12px;border-radius:8px;text-align:center;display:none}
.status-message.success{background:#d4edda;color:#155724;border:1px solid #c3e6cb;display:block}
.status-message.error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb;display:block}
.status-message.loading{background:#d1ecf1;color:#0c5460;border:1px solid #bee5eb;display:block}
.help-text{font-size:12px;color:#6c757d;margin-top:5px}
.spinner{
  display:inline-block;width:16px;height:16px;border:2px solid #f3f3f3;border-top:2px solid #667eea;
  border-radius:50%;animation:spin 1s linear infinite;margin-right:8px;vertical-align:middle}
@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
.section-title{font-size:16px;font-weight:600;color:#333;margin-bottom:15px;border-bottom:2px solid #e0e0e0;padding-bottom:5px}
</style>
</head>
<body>
  <div class="container">
    <h1>Media Tracker</h1>
    <p class="subtitle">Monitor media mentions across multiple platforms</p>

     <form id="mediaTrackerForm" enctype="multipart/form-data">
      <div class="form-group">
        <label for="googleAlertsRss">Google Alerts RSS Feed URL</label>
        <input type="url" id="googleAlertsRss" name="googleAlertsRss"
               placeholder="https://www.google.com/alerts/feeds/..." required>
        <p class="help-text">Enter your Google Alerts RSS feed URL</p>
      </div>

      <div class="form-group">
        <div class="section-title">CSV File Uploads</div>
        <div class="csv-uploads">
          <div>
            <label for="twitterCsvFile">Twitter/X Posts CSV</label>
            <div class="file-upload">
              <input type="file" id="twitterCsvFile" name="twitterCsvFile" accept=".csv">
              <label for="twitterCsvFile" class="file-upload-label twitter" id="twitterFileLabel">
                üê¶ Upload Twitter CSV
              </label>
            </div>
            <p class="help-text">CSV file with Twitter/X posts from Meltwater</p>
          </div>
          <div>
            <label for="newsCsvFile">News Articles CSV</label>
            <div class="file-upload">
              <input type="file" id="newsCsvFile" name="newsCsvFile" accept=".csv">
              <label for="newsCsvFile" class="file-upload-label" id="newsFileLabel">
                üì∞ Upload News CSV
              </label>
            </div>
            <p class="help-text">CSV file with news articles from Meltwater</p>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label>Data Sources</label>
        <div class="checkbox-group">
          <div class="checkbox-item">
            <input type="checkbox" id="sourceTwitter" name="sourceTwitter" checked>
            <label for="sourceTwitter">Twitter/X CSV</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="sourceGoogleNews" name="sourceGoogleNews" checked>
            <label for="sourceGoogleNews">Google News RSS</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="sourceNews" name="sourceNews" checked>
            <label for="sourceNews">News CSV</label>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="sheetUrl">Google Sheets URL</label>
        <input type="url" id="sheetUrl" name="sheetUrl"
               placeholder="https://docs.google.com/spreadsheets/d/..." required>
        <p class="help-text">URL of your Google Sheets for data storage</p>
      </div>

      <button type="submit" class="submit-btn" id="submitBtn">Start Media Tracking</button>
      <div id="statusMessage" class="status-message"></div>
    </form>
  </div>

<script>
const WEBHOOK_URL = '/api/webhook';

const form               = document.getElementById('mediaTrackerForm');
const twitterFileInput   = document.getElementById('twitterCsvFile');
const newsFileInput      = document.getElementById('newsCsvFile');
const twitterFileLabel   = document.getElementById('twitterFileLabel');
const newsFileLabel      = document.getElementById('newsFileLabel');
const submitBtn          = document.getElementById('submitBtn');
const statusMessage      = document.getElementById('statusMessage');

/* ‚Äî‚Äî helpers ‚Äî‚Äî */
const formatFileSize = b=>{
  if(!b) return '0 Bytes';
  const k=1024,sizes=['Bytes','KB','MB','GB'],i=Math.floor(Math.log(b)/Math.log(k));
  return Math.round(b/Math.pow(k,i))+' '+sizes[i];
};
const showStatus=(type,msg)=>{
  statusMessage.className='status-message '+type;
  statusMessage.textContent=msg;
};
const updateLabel=(input,label,emoji,defaultText)=>{
  const f=input.files[0];
  if(f){
    label.textContent=`${emoji} ${f.name} (${formatFileSize(f.size)})`;
    label.classList.add('has-file');
  }else{
    label.textContent=defaultText;
    label.classList.remove('has-file');
  }
};

/* ‚Äî‚Äî browse change ‚Äî‚Äî */
twitterFileInput.addEventListener('change',()=>updateLabel(twitterFileInput,twitterFileLabel,'üê¶','üê¶ Upload Twitter CSV'));
newsFileInput  .addEventListener('change',()=>updateLabel(newsFileInput,  newsFileLabel,  'üì∞','üì∞ Upload News CSV'));

/* ‚Äî‚Äî drag & drop ‚Äî‚Äî */
['dragover','dragenter'].forEach(evt=>{
  twitterFileLabel.addEventListener(evt,e=>{e.preventDefault();twitterFileLabel.style.background='#e3f2fd';});
  newsFileLabel  .addEventListener(evt,e=>{e.preventDefault();newsFileLabel.style.background  ='#e9ecef';});
});
['dragleave','drop'].forEach(evt=>{
  twitterFileLabel.addEventListener(evt,e=>{e.preventDefault();twitterFileLabel.style.background='#f8f9fa';});
  newsFileLabel  .addEventListener(evt,e=>{e.preventDefault();newsFileLabel.style.background  ='#f8f9fa';});
});
twitterFileLabel.addEventListener('drop',e=>{
  e.preventDefault();
  if(e.dataTransfer.files[0]?.type==='text/csv'){
    twitterFileInput.files=e.dataTransfer.files;
    updateLabel(twitterFileInput,twitterFileLabel,'üê¶','üê¶ Upload Twitter CSV');
  }
});
newsFileLabel.addEventListener('drop',e=>{
  e.preventDefault();
  if(e.dataTransfer.files[0]?.type==='text/csv'){
    newsFileInput.files=e.dataTransfer.files;
    updateLabel(newsFileInput,newsFileLabel,'üì∞','üì∞ Upload News CSV');
  }
});

/* ‚Äî‚Äî submit ‚Äî‚Äî */
form.addEventListener('submit',async e=>{
  e.preventDefault();
  submitBtn.disabled=true;
  submitBtn.innerHTML='<span class="spinner"></span>Processing‚Ä¶';
  showStatus('loading','Uploading files to workflow‚Ä¶');

  const fd=new FormData();
  fd.append('googleAlertsRss',  document.getElementById('googleAlertsRss').value);
  fd.append('sheetUrl',         document.getElementById('sheetUrl').value);
  fd.append('sourceTwitter',    document.getElementById('sourceTwitter').checked);
  fd.append('sourceGoogleNews', document.getElementById('sourceGoogleNews').checked);
  fd.append('sourceNews',       document.getElementById('sourceNews').checked);
  if(twitterFileInput.files[0]) fd.append('twitterCsvFile', twitterFileInput.files[0]);
   if(newsFileInput.files[0])    fd.append('meltwaterFile',    newsFileInput.files[0]);

  try{
    const res=await fetch(WEBHOOK_URL,{method:'POST',body:fd});
    if(!res.ok) throw new Error('HTTP '+res.status);
    showStatus('success','Workflow started. Check your Google Sheet soon.');
    form.reset();
    updateLabel(twitterFileInput,twitterFileLabel,'üê¶','üê¶ Upload Twitter CSV');
    updateLabel(newsFileInput,   newsFileLabel,  'üì∞','üì∞ Upload News CSV');
  }catch(err){
    showStatus('error','Upload failed: '+err.message);
  }finally{
    submitBtn.disabled=false;
    submitBtn.textContent='Start Media Tracking';
  }
});
</script>
</body>
</html>
